extends ../app_layout.pug

include ./nav/nav-visit.pug

include ./spinner.pug

block main
    main
        .row
            .col.s10.offset-s1.m8.offset-m2.l6.offset-l3
                h3.green-text.text-accent-4.margin-t-3 Sign In
            if error
                .col.s10.offset-s1.m8.offset-m2.l6.offset-l3
                   .chip.red.white-text.z-depth-1
                      | #{error}
                      i.close.material-icons close
            .col.s10.offset-s1.m8.offset-m2.l6.offset-l3
                form.margin-t-3(action="/signin", method="post")
                    label(for="email-account").margin-t-5.blue-grey-text What is your email address?
                    input#email-account.validate(type="email", name="email-account", placeholder="example@gmail.com", autofocus, required)
                    label(for="password-account").blue-grey-text What is your password?
                    input#password-account(type='password', name='password-account', placeholder='**********', maxlength='20', required='required', data-error='use a uppercase, a lowercase, a number, and no special characters')
                    button#signin-button.btn.green.accent-4.waves-effect.waves-light.margin-t-2(disabled)
                      | Sign in 
                      i.material-icons.right send
                    p.em0p7: a(href="/signup") Don't have an account yet? Click here

block scripts
    script(src='bower_components/jquery/dist/jquery.min.js')    
    script(src="bower_components/localforage/dist/localforage.min.js")
    include ./redirect_loggedin.pug
    script(src='bower_components/materialize/dist/js/materialize.min.js')
    script(src='js/navinit.js')
    script.
        $(document).ready(function () {
           
            var email = {};
            email.elem = $('#email-account');

            var password = {};
            password.elem = $('#password-account');
            password.value = '';
            password.isValid = false;

            var passwordValidation = /^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{6,20}$/;

            var signinButton = {};
            signinButton.elem = $('#signin-button');

            var areInputsAllValid = false;

            email.elem.on('keyup', function() {
               enableSigninButton(email,password,signinButton, areInputsAllValid);
             });

            password.elem.on('keyup', function() {
               isValidPassword(password); 
               enableSigninButton(email,password,signinButton, areInputsAllValid);
             });

            function isValidPassword(pw) {
                pw.value = pw.elem.val();
                pw.isValid = passwordValidation.test(pw.value);
                if (!pw.value) {
                    pw.elem.removeClass()
                 }
                else if (pw.isValid) {
                    pw.elem.removeClass('invalid');
                    pw.elem.addClass('valid');
                }
                else {
                    pw.elem.removeClass('valid');
                    pw.elem.addClass('invalid');
                }
            }

            function enableSigninButton(mail,pw1,accountButton,areInputsValid) {
               areInputsValid = mail.elem.hasClass('valid') && pw1.elem.hasClass('valid'); 
               if (!areInputsValid) {
                    accountButton.elem.prop('disabled', true);   
                } 
                else {
                    accountButton.elem.prop('disabled', false);   
                }
            }
        });
